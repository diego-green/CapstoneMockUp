@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - VISTA</title>

    <!-- Bootstrap CSS (choose ONE: CDN or local). CDN shown first -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- If you prefer local, comment the CDN above and use this (you have these paths in wwwroot): -->
    <!-- <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" /> -->

    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>

    <!-- Global left rail with hamburger -->
    <div class="page-rail">
        <!-- IMPORTANT: wire up the toggle -->
        <button class="rail-btn" aria-label="menu"
                type="button"
                data-bs-toggle="offcanvas"
                data-bs-target="#mainMenu"
                aria-controls="mainMenu">
            ≡
        </button>

        <div class="rail-spacer"></div>
        <button class="rail-btn rail-danger" aria-label="alerts">!</button>
        <button class="rail-btn" aria-label="settings">⚙</button>
        <form asp-page="/Account/SignOut" method="get">
            <button type="submit" class="rail-btn" aria-label="logout">↩</button>
        </form>
    </div>

    <header class="topbar">
        <!-- Left: Logo -->
        <div class="brand-badge">
            <span class="brand-vista">VISTA;</span>
            <img src="~/images/logo.png" alt="Logo" style="height:100px; width:100px;">
        </div>




        <!-- Center: Welcome text -->
        @{
            var isAuth = User?.Identity?.IsAuthenticated == true;
            var fullName = isAuth
            ? (User.FindFirst("given_name")?.Value
            ?? User.FindFirst("name")?.Value
            ?? User.Identity?.Name)
            : null;
        }
        <div class="topbar-title">
            @(isAuth ? $"Welcome, {fullName}" : "Welcome")
        </div>

        <!-- Right: Sign in / Sign out -->
        <div class="topbar-auth">
            <partial name="_AuthLinks" />
        </div>
    </header>

    <div class="content">
        @RenderBody()
    </div>


    <!-- Offcanvas side menu -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mainMenu" aria-labelledby="mainMenuLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="mainMenuLabel">Navigation</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <a class="text-decoration-none" asp-page="/Dashboard">🏠 Dashboard</a>
                </li>
                @if (User?.Identity?.IsAuthenticated ?? false)
                {
                    <li class="list-group-item">
                        <a class="text-decoration-none" asp-page="/Engineer">🛠 Engineer View</a>
                    </li>
                }
            </ul>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; @DateTime.Now.Year - Project VISTA</p>
    </footer>

    <!-- Scripts: Bootstrap bundle (with Popper) MUST be before offcanvas will work -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- If you prefer local, comment CDN and use: -->
    <!-- <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script> -->

    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
