@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - VISTA</title>

    <!-- Bootstrap (one source only) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Fluent v2 web components -->
    <script type="module" src="https://unpkg.com/@@fluentui/web-components"></script>

    <!-- App styles -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>
    <!-- Fixed left rail -->
    <div class="page-rail">
        <button class="rail-btn" aria-label="menu"
                type="button"
                data-bs-toggle="offcanvas"
                data-bs-target="#mainMenu"
                aria-controls="mainMenu">
            ≡
        </button>

        <div class="rail-spacer"></div>
        <button class="rail-btn rail-danger" aria-label="alerts">!</button>
        <button class="rail-btn" aria-label="settings">⚙</button>

        <form asp-page="/Account/SignOut" method="get">
            <button type="submit" class="rail-btn" aria-label="logout">↩</button>
        </form>
    </div>

    <!-- Top bar -->
    <header class="topbar">
        <div class="brand-card">
            <div class="brand-group">
                <img src="~/images/logo.png" alt="Logo" class="brand-logo" />
                <span class="brand-vista">VISTA</span>
            </div>
        </div>

        @{
            var isAuth = User?.Identity?.IsAuthenticated == true;
            var fullName = isAuth
            ? (User.FindFirst("given_name")?.Value
            ?? User.FindFirst("name")?.Value
            ?? User.Identity?.Name)
            : null;
        }
        <div class="topbar-title">
            @(isAuth ? $"Welcome, {fullName}" : "Welcome")
        </div>

        <div class="topbar-auth">
            <partial name="_AuthLinks" />
        </div>
    </header>



    <!-- Main content -->
    <div class="content">
        @RenderBody()
    </div>

    <!-- Off-canvas menu -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mainMenu" aria-labelledby="mainMenuLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="mainMenuLabel">Navigation</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <a class="text-decoration-none" asp-page="/Dashboard">🏠 Dashboard</a>
                </li>
                @if (User?.Identity?.IsAuthenticated ?? false)
                {
                    <li class="list-group-item">
                        <a class="text-decoration-none" asp-page="/Engineer">🛠 Engineer View</a>
                    </li>
                }
            </ul>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; @DateTime.Now.Year - Project VISTA</p>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
