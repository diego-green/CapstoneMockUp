@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - VISTA</title>

    <!-- Fluent v2 web components (must come before your CSS so tokens exist) -->
    <script type="module" src="https://unpkg.com/@@fluentui/web-components"></script>

    <!-- Bootstrap (kept only for offcanvas) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Your styles -->
    <link rel="stylesheet" href="~/css/layout.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>

    <!-- Left rail (Fluent buttons + tooltips) -->
    <div class="page-rail">
        <fluent-button id="railMenu"
                       class="icon-btn"
                       appearance="accent"
                       aria-label="Menu"
                       title="Menu"
                       role="button"
                       data-bs-toggle="offcanvas"
                       data-bs-target="#mainMenu"
                       aria-controls="mainMenu">
            <img src="~/icons/ic_fluent_navigation_24_filled.svg" alt="" />
        </fluent-button>
        <fluent-tooltip anchor="railMenu" position="right">Menu</fluent-tooltip>

        <div class="rail-spacer"></div>

        <fluent-button id="railAlerts" class="icon-btn" aria-label="Alerts" title="Alerts history">
            <img src="~/icons/ic_fluent_history_24_filled.svg" alt="" />
        </fluent-button>
        <fluent-tooltip anchor="railAlerts" position="right">Alerts</fluent-tooltip>

        <fluent-button id="railSettings" class="icon-btn" aria-label="Settings" title="Settings">
            <img src="~/icons/ic_fluent_settings_24_filled.svg" alt="" />
        </fluent-button>
        <fluent-tooltip anchor="railSettings" position="right">Settings</fluent-tooltip>

        <form asp-page="/Account/SignOut" method="get">
            <fluent-button id="railLogout" class="icon-btn" aria-label="Logout" title="Logout" type="submit">
                <img src="~/icons/ic_fluent_arrow_exit_24_filled.svg" alt="" />
            </fluent-button>
        </form>
        <fluent-tooltip anchor="railLogout" position="right">Logout</fluent-tooltip>
    </div>

    <!-- Top bar (Fluent layout) -->
    <header class="topbar">
        <fluent-card class="brand-card" appearance="accent">
            <div class="brand-group">
                <img src="~/images/logo.png" alt="Logo" class="brand-logo" />
                <span class="brand-vista">VISTA</span>
            </div>
        </fluent-card>

        @{
            var isAuth = User?.Identity?.IsAuthenticated == true;
            var fullName = isAuth
                ? (User.FindFirst("given_name")?.Value
                   ?? User.FindFirst("name")?.Value
                   ?? User.Identity?.Name)
                : null;
        }
        <div class="topbar-title">
            @(isAuth ? $"Welcome, {fullName}" : "Welcome")
        </div>

        <div class="topbar-auth">
            <partial name="_AuthLinks" />
        </div>
    </header>

    <!-- Main content -->
    <main class="content">
        @RenderBody()
    </main>

    <!-- Off-canvas menu (Bootstrap) -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mainMenu" aria-labelledby="mainMenuLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="mainMenuLabel">Navigation</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <nav class="nav-list">
                <fluent-anchor href="@Url.Page("/Dashboard")">🏠 Dashboard</fluent-anchor>
                @if (User?.Identity?.IsAuthenticated ?? false)
                {
                    <fluent-anchor href="@Url.Page("/Engineer")">🛠 Engineer View</fluent-anchor>
                }
            </nav>
        </div>
    </div>

    <!-- Footer -->
    <fluent-card class="footer" appearance="neutral">
        <span>&copy; @DateTime.Now.Year — Project VISTA</span>
    </fluent-card>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
