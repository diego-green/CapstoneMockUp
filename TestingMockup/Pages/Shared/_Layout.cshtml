@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - VISTA</title>

    <!-- Fluent v2 web components (must come before your CSS so tokens exist) -->
    <script type="module" src="~/lib/fluentui/web-components/dist/web-components.js"></script>

    <!-- Bootstrap (kept only for offcanvas) -->
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Your styles -->
    <link rel="stylesheet" href="~/css/layout.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>

    @{
        // Get current page path (e.g. "/Engineer/View", "/Engineer/Dashboard")
        var currentPage = Context.Request.Path.Value?.ToLower() ?? "";
    }

    <!-- Left rail (Fluent buttons + tooltips) -->
    <div class="page-rail">

        <fluent-button id="railMenu"
                       class="icon-btn"
                       appearance="accent"
                       aria-label="Menu"
                       title="Menu"
                       role="button"
                       data-bs-toggle="offcanvas"
                       data-bs-target="#mainMenu"
                       aria-controls="mainMenu">
            <img src="~/icons/ic_fluent_navigation_24_filled.svg" alt="" />
        </fluent-button>
        <fluent-tooltip anchor="railMenu" position="right">Menu</fluent-tooltip>

        <div class="rail-spacer"></div>

        @if (currentPage.Contains("/engineer"))
        {
            <fluent-button id="railHome"
                           class="icon-btn"
                           aria-label="Home"
                           onclick="window.location.href='@Url.Page("/Dashboard")'">
                <img src="~/icons/ic_fluent_home_24_filled.svg" alt="Home" />
            </fluent-button>
            <fluent-tooltip anchor="railHome" position="right">Home</fluent-tooltip>
        }

        <fluent-button id="railAlerts" class="icon-btn" aria-label="Alerts">
            <img src="~/icons/ic_fluent_history_24_filled.svg" alt="" />
        </fluent-button>
        <fluent-tooltip anchor="railAlerts" position="right">Alerts History</fluent-tooltip>

        <fluent-button id="railSettings" class="icon-btn" aria-label="Settings" >
            <img src="~/icons/ic_fluent_settings_24_filled.svg" alt="" />
        </fluent-button>
        <fluent-tooltip anchor="railSettings" position="right">Settings</fluent-tooltip>

        <form asp-page="/Account/SignOut" method="get">
            <fluent-button id="railLogout" class="icon-btn" aria-label="Logout" type="submit">
                <img src="~/icons/ic_fluent_arrow_exit_24_filled.svg" alt="" />
            </fluent-button>
        </form>
        <fluent-tooltip anchor="railLogout" position="right">Logout</fluent-tooltip>
    </div>

    <!-- Top bar (Fluent layout) -->
    <header class="topbar">
        <div class="brand-card">
            <div class="brand-group">
                <img src="~/images/logo.png" alt="Logo" class="brand-logo" />
                @* <span class="brand-vista">VISTA</span> *@
            </div>
        </div>

        @{
            var isAuth = User?.Identity?.IsAuthenticated == true;
            var fullName = isAuth
            ? (User.FindFirst("given_name")?.Value
            ?? User.FindFirst("name")?.Value
            ?? User.Identity?.Name)
            : null;
        }
        <div class="topbar-title">
            @(isAuth ? $"Welcome, {fullName}" : "Welcome") <!--Change to animation or sacarlo-->
        </div>

        <div class="topbar-auth">
            <partial name="_AuthLinks" />
        </div>
    </header>

    <!-- Main content -->
    <main class="content">
        @RenderBody()
    </main>

    <!-- Off-canvas menu (Bootstrap) -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mainMenu" aria-labelledby="mainMenuLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="mainMenuLabel">Navigation</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <nav class="nav-list">
                <fluent-anchor href="@Url.Page("/Dashboard")">🏠 Dashboard</fluent-anchor>
                @if (User?.Identity?.IsAuthenticated ?? false)
                {
                    <fluent-anchor href="@Url.Page("/Engineer")">🛠 Engineer View</fluent-anchor>
                }
            </nav>
        </div>
    </div>

    @* <!-- Footer -->
    <fluent-card class="footer" appearance="neutral">
        <span>&copy; @DateTime.Now.Year — Project VISTA</span>
    </fluent-card> *@

    <!-- Scripts (local only) -->
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/htmx/dist/htmx.min.js"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
